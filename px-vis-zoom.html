<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="px-vis-behavior-common.html" />
<link rel="import" href="px-vis-behavior-d3.html" />


<!--
Element providing an on-chart zoom.

##### Usage

    <px-vis-zoom
        margin="[[margin]]"
        extents-data="[[extentsData]]"
        selected-domain="{{selectedDomain}}"
        px-svg-elem={{pxSvgElem}}>
    </px-vis-zoom>

@element px-vis-zoom
@blurb Element providing an on-chart zoom.
@homepage index.html
@demo demo.html
-->

<link rel="import" href="css/px-vis-zoom-styles.html">

<dom-module id="px-vis-zoom">
    <template>
      <style include="px-vis-zoom-styles"></style>
    </template>
</dom-module>

<script>
  Polymer({

    is: 'px-vis-zoom',

    behaviors: [
      PxVisBehavior.extentsData,
      PxVisBehaviorD3.selectedDomain
    ],

    /**
     * Properties block, expose attribute values to the DOM via 'reflect'
     *
     * @property properties
     * @type Object
     */
    properties: {
      /**
       * Whether we're currently zoomed in
       */
      zoomed: {
        type: Boolean,
        value: false
      },
      /**
       * Stack of previous zooms
       */
      zoomStack: {
        type: Array,
        value: function() {
          return [];
        }
      }
    },
    observers: [
      'zoom(extentsData)'
    ],

    /**
     * Restore zoom to its previous value, do nothing if no previous value
     */
    undoZoom: function() {
      if(this.zoomStack.length === 1) {
        this.resetZoom();
      }

      var extentsData = this.pop('zoomStack');
      if(extentsData) {
        this.set('selectedDomain', extentsData);
        this.fire('px-vis-selected-domain-updated', { 'data':extentsData, 'method': 'set', 'dataVar': 'selectedDomain' });
      }
    },
    /**
     * Sets the selectedDomain to the drawn zoom and shows the button
     *
     */
    zoom: function(extentsData) {

      //remember zoom
      this.push('zoomStack', this.selectedDomain);

      this.zoomed = true;

      this.set('selectedDomain', {x:extentsData.eX, y:extentsData.eY});
      this.fire('px-vis-selected-domain-updated', { 'data':{x:extentsData.eX, y:extentsData.eY}, 'method': 'set', 'dataVar': 'selectedDomain' });
    },
    /**
     * resets the extents
     *
     */
    resetZoom: function(){
      this.set('selectedDomain', 'reset');
      this.zoomed = false;

      //ensure the zoom stack is reset
      this.splice('zoomStack', 0, this.zoomStack.length);

      this.fire('px-vis-selected-domain-updated', { 'data':'reset', 'method': 'set', 'dataVar': 'selectedDomain' });
    }
  });
</script>
