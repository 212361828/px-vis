<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="../px-colors-design/colors.html" />
<link rel="import" href="px-vis-behavior-common.html" />
<link rel="import" href="px-vis-behavior-d3.html" />
<link rel="import" href="px-vis-register.html" />


<!--
Element providing on-chart tooltip display
- Consumes tooltipData property

It is a recasting of the px-vis-register, but following the cursor over the chart

##### Usage

    <px-vis-tooltip
          svg="[[svg]]"
          width="250"
          margin="[[margin]]"
          chart-data="[[chartData]]"
          tooltip-data="[[tooltipData]]">
      </px-vis-tooltip>

@element px-vis-tooltip
@blurb Element providing on-chart tooltip display
@homepage index.html
@demo demo.html

-->
<dom-module id="px-vis-tooltip">
    <link rel="import" type="css" href="css/px-vis-tooltip.css"/>
    <template>
      <px-vis-register
        id="tooltip"
        class="hidden"
        height="[[height]]"
        width="[[width]]"
        units="Hz"
        tooltip-data=[[tooltipData]]
        muted-series="[[mutedSeries]]"
        chart-data="[[chartData]]">
      </px-vis-register>
    </template>
</dom-module>

<script>
  Polymer({

    is: 'px-vis-tooltip',

    behaviors: [
      PxVisBehavior.sizing,
      PxVisBehaviorD3.svg,
      PxVisBehavior.dataset,
      PxVisBehavior.tooltipData,
      commonColors
    ],

    /**
     * Properties block, expose attribute values to the DOM via 'reflect'
     *
     * @property properties
     * @type Object
     */
    properties: {
      /**
       * Holder for the svg g elem's client rect
       *
       * @property _rect
       * @type Object
       */
      _rect: {
        type: Object
      }
    }, //properties

    observers: [
      '_updateTooltip(tooltipData.*)',
      '_setRect(svg)'
     ],
     /**
     * Sets _rect when svg is passed in
     *
     * @method _setRect
     */
    _setRect: function(){
      this.set('_rect', this.svg.node().getBoundingClientRect());
    },
    /**
    * fired by observer and shows/hides the tooltip and moves it into the proper location
    *
    * @method _updateTooltip
    */
    _updateTooltip: function(){
      if(this.tooltipData.time === null){
        this.toggleClass('hidden',true, this.$.tooltip);
      } else {
        this.toggleClass('hidden',false, this.$.tooltip);
        // this._setRect();
        this._moveTooltip();
      }
    },
    /**
    * calulates the correct position to move the tooltip to follow the mouse
    *
    * @method _updateTooltip
    */
    _moveTooltip: function() {
      // TODO allow spacing adjustment
      this.$.tooltip.style.left = this._rect.left + 55 + this.tooltipData.mouse[0] + 'px';
      this.$.tooltip.style.top =  this._rect.top + 38 + this.tooltipData.mouse[1]  + 'px';
    }
  });
</script>
