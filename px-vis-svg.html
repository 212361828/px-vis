<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="px-vis-behavior-common.html" />
<link rel="import" href="px-vis-behavior-d3.html" />


<!--
Element which creates an SVG element and sets up d3

##### Usage

    <px-vis-svg
        svg="{{svg}}"
        width="[[width]]"
        height="[[height]]"
        margin="[[margin]]">
    </px-vis-svg>

@element px-vis-svg
@blurb Element which creates an SVG element and sets up d3
@homepage index.html
@demo demo.html
-->
<dom-module id="px-vis-svg">
    <link rel="import" type="css" href="css/px-vis.css"/>
    <template>
      <svg class="px-vis-svg">
        <content></content>
      </svg>
    </template>
</dom-module>

<script>
    Polymer({

        is: 'px-vis-svg',

        /****** EVENTS ******/
        /**
         * Fired once d3 svg drawing element has been configured
         *
         * Detail includes:
         *
         * ```
         * { 'svg': svgElem }
         * ```
         *
         * @event px-vis-svg-updated
         */

        behaviors: [
          PxVisBehavior.sizing,
          PxVisBehavior.svg
        ],

        /**
         * Properties block, expose attribute values to the DOM via 'reflect'
         *
         * @property properties
         * @type Object
         */
        properties: {
          /**
           * A list of sub elements should we need to know our children
           *
           *
           * @default []
           */
          // _childElems:{
          //   type:Array,
          //   value:[]
          // },
        },

        observers: [
          '_setSVG(width,height,margin)'
        ],



        /**
         *  When ready, let's find out who our children are
         */
        // ready: function() {
        //   // Polymer.dom(this).observeNodes(this._onEffectiveDomUpdated.bind(this));
        // },
        // created: function(){
        // },
        // attached: function() {
        // },

        // _onEffectiveDomUpdated: function (info) {
        //   this.async(function () {
        //     info.addedNodes.forEach(this._onNodeAdded.bind(this));
        //   });
        // },
        // _onNodeAdded: function (node) {
        //   if (!(node instanceof Text)) {
        //     node.__map = this.map;
        //     this._childElems.push(node);
        //   }
        // },

        /**
         * Configures the SVG and d3 drawing element
         *
         * @method _setSVG
         */
        _setSVG: function(){
          var svg = d3.select(this.$$("svg"))
            .attr('width',this.width)
            .attr('height',this.height);
          this.svg = (typeof(this.svg) === 'undefined') ? svg.append('g') : this.svg;
          this.svg.attr('width',this.width)
            .attr('height',this.height)
            .attr("transform", "translate(" + this.margin.left + ',' + this.margin.top + ")");

          this.notifyPath('svg',this.svg);
          this.fire('px-vis-svg-updated',{ 'svg': this.svg });
        },
    });
</script>
