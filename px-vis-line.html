<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="../px-vis-common.html" />
<link rel="import" href="../px-vis-svg-chart-common.html" />
<link rel="import" href="../px-colors-design/colors.html" />


<!--
Element providing solution to no problem in particular. As a simple, increments a counter when clicked.

##### Usage

    <px-vis counter-value="1">Hi</px-vis>

@element px-vis
@blurb Element providing solution to no problem in particular.
@homepage index.html
@demo demo.html
-->
<dom-module id="px-vis-line">
    <link rel="import" type="css" href="css/px-vis.css"/>
    <template>

    </template>
</dom-module>

<script>
    Polymer({

        is: 'px-vis-line',

        behaviors: [
          pxVisSVGChartCommonBehavior,
          commonColors
        ],

        observers: [
          // TODO Does chartData need to be chartData.* or chartData.series.* for dynamic data?
          '_drawElement(svg,x,y,setDomainX,setDomainY,chartData)'
         ],

        /**
         * Properties block, expose attribute values to the DOM via 'reflect'
         *
         * @property properties
         * @type Object
         */
        properties: {
          lineId:{
            type:String,
            // TODO make default value some kind of hash so it is unique? Maybe when we get data, some hash of the data?
            value:'myLine'
          },
          seriesNumber:{
            type:Number,
            value:0
          }

        },
        /**
         * Draws or updates the line element.
         * Called from an observer watching for data and the necessary d3 objects
         *
         * @method _drawElement
         */
        _drawElement: function() {
          // console.log("line chartdata");
          if(typeof(this.svg) !== 'undefined' && !this._isObjEmpty(this.x) && !this._isObjEmpty(this.y) && (this.chartData)){
            var self = this;
            var data = this.chartData.series;
            var index = this.seriesNumber;

            var line = d3.svg.line()
              .x(function(d) { return self.x(d[0]); })
              .y(function(d) { return self.y(d[1]); });
            // checks to see if the axis already exists. If not, create; if so, update
            var linePath = this.svg.select('path.series-line[line-id=' + this.lineId + ']');

            if(linePath.empty()){
              this.svg.append("path")
                .datum(data)
                .attr("class", "series-line")
                .attr("line-id", this.lineId)
                .attr('fill','none')
                .attr('stroke',this.dataVisColors[this.seriesColorOrder[index]])
                .attr("d", line);
            } else {
              linePath.datum(data)
              // .duration(750)
              .attr("d", line);
            }
          }
        }
    });
</script>
